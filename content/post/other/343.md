---
title: "CapabilityAPIを使う場合、アプリのパッケージ名に注意"
slug: 343
date: 2016-06-18
lastmod: 2016-06-18
tags:
    - Android
    - wear
---

Android Wearのアプリを作成する際には、パッケージ名をスマホ側と同じにしなければなりません。

新規プロジェクトで初めからWear用のアプリも含めて開発する際は関係ない話です。Android Studioの新規プロジェクトウィザードでターゲットにWearを追加するだけなので、両者のパッケージ名を別のものにしようと思ってもできません。

気をつけなければならないのは、スマホ用のアプリを作成していて、途中からWear用のモジュールを追加する場合です。「Wear用のモジュールだからパッケージ名変えたほうがいいかな」なんて気を利かせると逆にハマります（私のように）。

（ちなみにここで言っているパッケージ名は、アプリのパッケージ名のことです）

開発時はWear用のモジュールを実行、スマホ用のモジュールを実行という感じでアプリをインストールして実行できるので問題に気づきにくいのですが、Wearとスマホで通信を行おうとした際にハマります。

具体的にはCapability APIを使って通信可能なノードを取得する際に、パッケージ名が違うとそのノードが取得できません。

<a href="http://stackoverflow.com/questions/35136881/cant-detect-node-using-the-capability-api">http://stackoverflow.com/questions/35136881/cant-detect-node-using-the-capability-api</a>

Capability APIはWearからの要求に応答可能なデバイスを探すための仕組みです。例えば自分で
「say_helloという要求を行う」と定義しておけば、Wearからメッセージを送信する際にsay_helloが定義されているデバイスだけを、Capability APIを使うことによって取得することが出来るのです。しかし、それはパッケージ名が同じアプリであればの話です。

ちなみにNode APIを使えばパッケージ名が異なっていようが関係なく、ペアリングされているノードが取得できます。パッケージ名が異なると接続されているノードが取得できないのはCapability APIを使った場合の話のようです。

Wearアプリを作成する場合、パッケージ名を変えることは基本的にはないと思いますが、Wearのパッケージ名とスマホのパッケージ名を異なるものにすると弊害があるぞというお話でした。特に後からWear用のパッケージを追加するときには気をつけましょう。


  